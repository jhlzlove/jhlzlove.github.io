---
title: 微服务笔记
categories:
  - Java
  - 微服务
music:
  server: netease
  type: song
  id: 430793674
abbrlink: 659da5b
---

微服务笔记整理

<!-- more -->

<!-- @import "[TOC]" {cmd="toc" depthFrom=2 depthTo=6 orderedList=true} -->
微服务使用依赖版本号：
spring boot：2.3.2.RELEASE
spring cloud：Hoxton.SR9
spring cloud Alibaba：2.2.6.RELEASE
sentinel：1.8.1
nacos：1.4.2
rocketMQ：4.4.0
Dubbo：2.7.8
seata：1.3.0

微服务的版本选择需要有一定的要求，不然可能出现冲突和其它的问题：
[版本选择参考](https://blog.csdn.net/wcnmlgb888/article/details/82713106)

Eureka 包含两个组件：Eureka Server 和Eureka Client
微服务之consul：
服务启动(启动注册中心)：consul agent -dev；
之后访问管理页面 localhost:8500；
配置环境变量，可以快速启动；

服务间进行通信：
springcloud 推荐使用 `http rest` 方式进行系统间通信
ribbon 实现负载均衡的组件，restTemplate (http应用层协议)发起请求；
缺点：路径写死在代码中，不利于维护

openfegin组件(内部集成了ribbon)：
解决 RestTemplate 实现服务间通信的所有问题
使用简单：写一个接口，加一个注解。***推荐使用***
使用时最好明确传参方式：@PathVariable 路径传参，@RequestParam 问号后传参，@RequestBody 对象传参


Hystrix 组件 防雪崩利器
断路器打开条件：
a. 当满足一定的阈值，默认10秒内超过20个请求
b. 当失败率达到一定的时候，默认10秒内超过50%的请求失败
sentinel （阿里的组件）

Kafka、solr安装路径不能有空格

solr(搜索)：
schema.xml中有静态域，动态域，拷贝域(多域搜索)

微服务：一种服务架构。基于单体应用的业务进行拆分，拆分的每一个服务都是一个独立项目，针对拆分出来的微服务都是基于分布式管理；
微服务的通信方式：`RPC协议、Http协议(推荐)`
优点：1、拆分的每个服务各司其职，解耦合
     2、每个服务高度自治
     3、不会因为一个服务的问题导致其他服务不可用

缺点：1、服务部署复杂度增加
     2、分布式系统复杂(服务间通信、负载均衡...高可用等等)

SpringCloud 微服务工具集
作用：提供了一站式微服务工具，帮助我们解决了分布式系统中各种问题，让开发人员更专注于自己的业务开发。
SpringCloud 工具的核心组件：
    a. 服务注册中心：管理微服务的健康值状态
        1、Eureka(Netflix)
        2、consul(GO)
        3、zookeeper(java)
        4、nacos(alibaba)
    b. 服务间通信：
        1、RestTemplate
        2、Ribbon(NetFlix) 实现负载均衡
        3、OpenFeign(包含Ribbon)伪http客户端，支持Spring注解(推荐)
    c. 服务熔断器：（解决服务雪崩问题）
        1、Hystrix(进入了维护模式)

    d. 服务网关中心：提供请求统一入口，路由转发，过滤
        1、Gateway (转发、负载均衡、断言、过滤)
        2、zuul1.x zuul2.x
    e. 统一配置中心
        1、config组件：
            ConfigServer获取远程仓库的地址存入本地仓库
            ConfigClient根据ConfigServer读取自身配置
        2、bus组件：消息总线：将微服务所有节点链接到一起，通过总线实现自动配置刷新
**注意：**
使用 OpenFeign 组件进行客户端的服务通信时，映射地址(@RequestMapping)和被调用的 FeignClient 的对应的方法映射地址必须相同；方法名称可以不同，但为确保一致性，推荐使用相同的方法名和相同的映射地址。

SpringCloud Alibaba组件:
引入依赖：
```xml{.line-numbers}
    <!--spring cloud alibabab 依赖-->
    <!--全局配置中心依赖-->
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-nacos-config</artifactId>
        <version>2.2.6.RELEASE</version>
    </dependency>
    <!--服务注册中心依赖-->
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
        <version>2.2.6.RELEASE</version>
    </dependency>

    <!-- openfeign 依赖-->
    <dependency>
        <groupId>org.springframework.cloud</groupId>
        <artifactId>spring-cloud-starter-openfeign</artifactId>
    </dependency>
    <!-- sentinel 依赖-->
    <dependency>
    <groupId>com.alibaba.csp</groupId>
    <artifactId>sentinel-core</artifactId>
    <version>1.7.2</version>
    </dependency>
    <dependency>
        <groupId>com.alibaba.cloud</groupId>
        <artifactId>spring-cloud-starter-alibaba-sentinel</artifactId>
    </dependency>
```
nacos(端口8848)
OpenFeign、
sentinel(哨兵)：
> 阿里开源，替换Hystrix，对现有微服务提供保护。功能强大。
sentinel :
五大规则：
    a.流控规则: 只能使用别名(@SentinelResource())，才能使用自定义处理
    b.降级规则
    c.热点规则
    d.系统规则
    e.授权规则

nacos统一配置中心：
nacos 两种远程读取文件方式
名称 +　后缀
前缀 + 开发环境 + 后缀
```properties{.line-numbers}
    # 第一种获取远程配置的方式 名称 + 后缀 == dataID
    spring.cloud.nacos.server-addr=localhost:8848
    spring.cloud.nacos.config.namespace=
    spring.cloud.nacos.config.group=USERS
    spring.cloud.nacos.config.name=users-prod
    spring.cloud.nacos.config.file-extension=properties
    # 配置名称
    spring.cloud.nacos.config.name=configclient-prod
    # 配置的后缀名称
    spring.cloud.nacos.config.file-extension=properties

    # 第二种获取远程配置的方式 前缀 + 环境 + 后缀
    # 例如 configclient-prod.properties
    # 前缀
    #spring.cloud.nacos.config.prefix=configclient
    # 后缀
    #spring.cloud.nacos.config.file-extension=properties
    # 间隔符
    #spring.profiles.active=prod

    # 命名空间
    #spring.cloud.nacos.config.namespace=public
    # 配置所属组id
    #spring.cloud.nacos.config.group=
    # nacos 注册发现
    #spring.cloud.nacos.discovery.enabled=true
    # 注册中心地址
    #spring.cloud.nacos.server-addr=localhost:8848

    # 与 sentinel dashboard 通信
    spring.cloud.sentinel.enabled=true
    spring.cloud.sentinel.eager=true
    spring.cloud.sentinel.transport.port=8719
    spring.cloud.sentinel.transport.dashboard=localhost:9191

```
注解说明：
@EnableDiscoveryClient
这个注解，这个注解的作用是让该服务放注册中心注册和从注册中心获取其他服务
@RefreshScope
实现拉取远程配置自动刷新；不用重新启动，修改远程文件刷新即可生效

springcloud && springcloud alibaba
springcloud 微服务工具集
springcloud alibaba 微服务一站式解决方案

springcloud 五大组件
    a. 服务注册中心    eureka consul
    b. 服务间通信组件(Ribbon)  Openfeign/RestTemplete
    c. 服务熔断    Hystrix Hystrix DashBoard
    d. 服务网关    zuul.x zuul2.x Gateway
    e. 服务配置中心    config + bus 自动配置刷新

springcloud alibaba组件
    a. 服务注册中心    nacos => 替换 eureka consul 替换 config + bus
    b. 服务熔断、流控  sentinel => 替换 Hystrix

总结： 五大组件
    a. 服务注册中心： nacos
    b. 服务间通信组件： 1. RestTemplate + Ribbon 2.OpenFegin 组件
    c. 服务熔断、流控： sentinel
    d. 服务网关： gateway
    e. 服务配置中心： nacos

jps
展示Java相关的进程


